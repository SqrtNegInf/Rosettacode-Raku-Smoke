#!/usr/bin/env perl6
#u# http://rosettacode.org/wiki/Percolation/Mean_run_density
#c# 2016-06-11 <RC
#m# MOAR: OK
#j#  JVM: OK

my @res;

srand 123456;

sub R($n, $p) { [+] ((rand < $p) xx $n).squish }

say 't= ', constant t = 100;

for .1, .3 ... .9 -> $p {
    @res.push: "p= $p, K(p)= {$pÃ—(1-$p)}";
    for 10, 100, 1000 -> $n {
	@res.push: sprintf "  R(%6d, p)= %f", $n, t R/ [+] R($n, $p)/$n xx t
    }
}

.say for @res;

my $moar-terminal = qq:to/END/;
p= 0.1, K(p)= 0.09
  R(    10, p)= 0.100000
  R(   100, p)= 0.088100
  R(  1000, p)= 0.089850
p= 0.3, K(p)= 0.21
  R(    10, p)= 0.228000
  R(   100, p)= 0.210000
  R(  1000, p)= 0.211920
p= 0.5, K(p)= 0.25
  R(    10, p)= 0.281000
  R(   100, p)= 0.256200
  R(  1000, p)= 0.251070
p= 0.7, K(p)= 0.21
  R(    10, p)= 0.262000
  R(   100, p)= 0.215300
  R(  1000, p)= 0.208510
p= 0.9, K(p)= 0.09
  R(    10, p)= 0.155000
  R(   100, p)= 0.094000
  R(  1000, p)= 0.091480
END

my $moar-cronjob = qq:to/END/;
p= 0.1, K(p)= 0.09
  R(    10, p)= 0.099000
  R(   100, p)= 0.088000
  R(  1000, p)= 0.089810
p= 0.3, K(p)= 0.21
  R(    10, p)= 0.221000
  R(   100, p)= 0.209600
  R(  1000, p)= 0.211970
p= 0.5, K(p)= 0.25
  R(    10, p)= 0.281000
  R(   100, p)= 0.256500
  R(  1000, p)= 0.251050
p= 0.7, K(p)= 0.21
  R(    10, p)= 0.272000
  R(   100, p)= 0.215200
  R(  1000, p)= 0.208430
p= 0.9, K(p)= 0.09
  R(    10, p)= 0.155000
  R(   100, p)= 0.094000
  R(  1000, p)= 0.091430
END

my $jvm = qq:to/END/;
p= 0.1, K(p)= 0.09
  R(    10, p)= 0.087000
  R(   100, p)= 0.093700
  R(  1000, p)= 0.089580
p= 0.3, K(p)= 0.21
  R(    10, p)= 0.218000
  R(   100, p)= 0.209200
  R(  1000, p)= 0.210270
p= 0.5, K(p)= 0.25
  R(    10, p)= 0.266000
  R(   100, p)= 0.254000
  R(  1000, p)= 0.250660
p= 0.7, K(p)= 0.21
  R(    10, p)= 0.263000
  R(   100, p)= 0.214400
  R(  1000, p)= 0.212550
p= 0.9, K(p)= 0.09
  R(    10, p)= 0.165000
  R(   100, p)= 0.100200
  R(  1000, p)= 0.092000
END

use Test;
is @res.join("\n"), chomp $*VM ~~ /jvm/ ?? $jvm !! $*IN.t ?? $moar-terminal !! $moar-cronjob;
