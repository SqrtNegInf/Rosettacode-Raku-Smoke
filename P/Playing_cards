#!/usr/bin/env perl6
#u# http://rosettacode.org/wiki/Playing_cards
#c# 2016-08-03 <>RC
#m# MOAR: OK
#j#  JVM: OK
#   made some new methods...
#n#  2023-02-20 replace call to built-in 'rand' for output stability

use myRNG;
my $rng = myRNG.new( :seed(123456) );

# Knuth shuffle
sub pick-all (@a is copy) is export {
    for 1 ..^ @a -> $n {
        my $k = (0 .. $n)[($n+1) √ó $rng.next-rat];
        $k == $n or @a[$k, $n] = @a[$n, $k];
    }
    @a
}

#enum Pip üÉÅA 2 3 4 5 6 7 8 9 10 J Q KüÉÅ; # no, but cf Perl version
enum Pip ¬´ A 2 3 4 5 6 7 8 9 10 J Q K ¬ª; # spaces fine
enum Suit<‚ô¶ ‚ô£ ‚ô• ‚ô†>;                      # no space fine too

class Card {
    has Pip $.pip;
    has Suit $.suit;

    method Str { $!pip ~ $!suit }
}

class Deck {
    has Card @.cards = map { Card.new(:$^pip, :$^suit) }, flat (Pip.pick(*).sort X Suit.pick(*).sort);

    method shuffle { @!cards .= &pick-all }
   #method shuffle { @!cards .= pick: * }

    method deal { shift @!cards }

    method cheat { splice @!cards, @!cards.elems-1, 1 }

    method peek { @!cards[0] }

    method Str  { ~@!cards }
    method gist { ~@!cards }
}

my Deck $d = Deck.new;
my @res.push: "Deck: $d";

my $top = $d.deal;
@res.push: "Deal top card: $top";

$d.shuffle;
@res.push: "Deck, re-shuffled: $d";

my $peek = $d.peek;
@res.push: "Peek at top card: $peek";

my $bottom = $d.cheat;
@res.push: "Bottom of deck card: $bottom";

@res.push: "Deck state now: $d";

.say for @res;

my $ref = qq:to/END/;
Deck: A‚ô¶ A‚ô£ A‚ô• A‚ô† 2‚ô¶ 2‚ô£ 2‚ô• 2‚ô† 3‚ô¶ 3‚ô£ 3‚ô• 3‚ô† 4‚ô¶ 4‚ô£ 4‚ô• 4‚ô† 5‚ô¶ 5‚ô£ 5‚ô• 5‚ô† 6‚ô¶ 6‚ô£ 6‚ô• 6‚ô† 7‚ô¶ 7‚ô£ 7‚ô• 7‚ô† 8‚ô¶ 8‚ô£ 8‚ô• 8‚ô† 9‚ô¶ 9‚ô£ 9‚ô• 9‚ô† 10‚ô¶ 10‚ô£ 10‚ô• 10‚ô† J‚ô¶ J‚ô£ J‚ô• J‚ô† Q‚ô¶ Q‚ô£ Q‚ô• Q‚ô† K‚ô¶ K‚ô£ K‚ô• K‚ô†
Deal top card: A‚ô¶
Deck, re-shuffled: 6‚ô• A‚ô£ 8‚ô£ K‚ô¶ 10‚ô† 5‚ô† 2‚ô¶ 3‚ô• 3‚ô† 6‚ô† Q‚ô¶ 2‚ô£ Q‚ô• 5‚ô£ 9‚ô† 8‚ô• 10‚ô• Q‚ô£ K‚ô£ 4‚ô• J‚ô¶ K‚ô† 4‚ô¶ 7‚ô† 4‚ô† 10‚ô¶ 4‚ô£ 9‚ô¶ 9‚ô£ 3‚ô£ A‚ô† 7‚ô£ 5‚ô• J‚ô† 6‚ô¶ A‚ô• J‚ô• Q‚ô† 7‚ô• 10‚ô£ 6‚ô£ 7‚ô¶ 2‚ô• 5‚ô¶ J‚ô£ K‚ô• 3‚ô¶ 8‚ô¶ 2‚ô† 9‚ô• 8‚ô†
Peek at top card: 6‚ô•
Bottom of deck card: 8‚ô†
Deck state now: 6‚ô• A‚ô£ 8‚ô£ K‚ô¶ 10‚ô† 5‚ô† 2‚ô¶ 3‚ô• 3‚ô† 6‚ô† Q‚ô¶ 2‚ô£ Q‚ô• 5‚ô£ 9‚ô† 8‚ô• 10‚ô• Q‚ô£ K‚ô£ 4‚ô• J‚ô¶ K‚ô† 4‚ô¶ 7‚ô† 4‚ô† 10‚ô¶ 4‚ô£ 9‚ô¶ 9‚ô£ 3‚ô£ A‚ô† 7‚ô£ 5‚ô• J‚ô† 6‚ô¶ A‚ô• J‚ô• Q‚ô† 7‚ô• 10‚ô£ 6‚ô£ 7‚ô¶ 2‚ô• 5‚ô¶ J‚ô£ K‚ô• 3‚ô¶ 8‚ô¶ 2‚ô† 9‚ô•
END

use Test;
is @res.join("\n"), chomp $ref;
