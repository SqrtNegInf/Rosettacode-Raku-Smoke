#!/usr/bin/env raku
#u# https://www.rosettacode.org/wiki/Permutations/Derangements
#c# 2024-04-16 <RC
#m# MOAR: OK
#j# JVM:  OK
#n# alt method much faster: calculate the subfactorial

my @res;

my @subfactorial = 1,0,{++$ × ($^a + $^b)}…*;

push @res, "!$_: " ~ @subfactorial[$_] for |^10, 20, 200;

.say for @res;

my $ref = q:to/END/;
!0: 1
!1: 0
!2: 1
!3: 2
!4: 9
!5: 44
!6: 265
!7: 1854
!8: 14833
!9: 133496
!20: 895014631192902121
!200: 290131015521620609254546237518688936375622413566095185632876940298382875066633305125595907908697818551860745708196640009079772455670451355426573609799907339222509103785567575227183775791345718826220455840965346196540544976439608810006794385963854831693077054723298130736781093200499800934036993104223443563872463385599425635345341317933466521378117877578807421014599223577201
END

use Test;
is @res.join("\n"), chomp $ref;
