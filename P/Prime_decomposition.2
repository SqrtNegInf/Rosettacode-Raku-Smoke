#!/usr/bin/env perl6
#n# NOT CURRENT, NOT SMOKE-TESTED
#u# http://rosettacode.org/wiki/Prime_decomposition
#c# 2016-06-28 <RC
#m# MOAR: OK
#j#  JVM: OK

multi sub MAINly ( 'Mersenne', $n ) {
    my @super = <⁰ ¹ ² ³ ⁴ ⁵ ⁶ ⁷ ⁸ ⁹>;
    for 2 .. $n {
       my $m = 2**$_ - 1;
       return "factors of 2{ @super[$_.comb].join }-1 ($m): ",
         prime-factors( $m ).join(' × ');
    }
}

multi sub MAINly ( *@numbers ) {
    for @numbers -> $n {
        return "factors of $n: ", prime-factors($n).join(' × ');
    }
}

sub prime-factors ( Int $n where * > 0 ) {
    return $n if $n.is-prime;
    return [] if $n == 1;
    my $factor = find-factor( $n );
    sort flat prime-factors( $factor ), prime-factors( $n div $factor );
}

sub find-factor ( Int $n, $constant = 1 ) {
    my ($x, $rho, $factor) = 2, 1, 1;
    while $factor == 1 {
        $rho *= 2;
        my $fixed = $x;
        for 1 ..^ $rho {
            $x = ($x² + $constant) % $n;
            $factor = ($x - $fixed) gcd $n;
            last if $factor > 1;
        }
    }
    $factor = find-factor( $n, $constant + 1 ) if $n == $factor;
    $factor;
}

#`{
With input: 536870911

factors of 536870911: 233 × 1103 × 2089
With input: Mersenne 100 (takes about 7 seconds, most of that for 2⁹⁸-1)

factors of 2²-1 (3): 3
factors of 2³-1 (7): 7
factors of 2⁴-1 (15): 3 × 5
factors of 2⁵-1 (31): 31
factors of 2⁶-1 (63): 3 × 3 × 7
factors of 2⁷-1 (127): 127
factors of 2⁸-1 (255): 3 × 5 × 17
factors of 2⁹-1 (511): 7 × 73
factors of 2¹⁰-1 (1023): 3 × 11 × 31
factors of 2¹¹-1 (2047): 23 × 89
factors of 2¹²-1 (4095): 3 × 3 × 5 × 7 × 13
factors of 2¹³-1 (8191): 8191
factors of 2¹⁴-1 (16383): 3 × 43 × 127
factors of 2¹⁵-1 (32767): 7 × 31 × 151
factors of 2¹⁶-1 (65535): 3 × 5 × 17 × 257
factors of 2¹⁷-1 (131071): 131071
factors of 2¹⁸-1 (262143): 3 × 3 × 3 × 7 × 19 × 73
factors of 2¹⁹-1 (524287): 524287
factors of 2²⁰-1 (1048575): 3 × 5 × 5 × 11 × 31 × 41
factors of 2²¹-1 (2097151): 7 × 7 × 127 × 337
factors of 2²²-1 (4194303): 3 × 23 × 89 × 683
factors of 2²³-1 (8388607): 47 × 178481
factors of 2²⁴-1 (16777215): 3 × 3 × 5 × 7 × 13 × 17 × 241
factors of 2²⁵-1 (33554431): 31 × 601 × 1801
factors of 2²⁶-1 (67108863): 3 × 2731 × 8191
factors of 2²⁷-1 (134217727): 7 × 73 × 262657
factors of 2²⁸-1 (268435455): 3 × 5 × 29 × 43 × 113 × 127
factors of 2²⁹-1 (536870911): 233 × 1103 × 2089
factors of 2³⁰-1 (1073741823): 3 × 3 × 7 × 11 × 31 × 151 × 331
factors of 2³¹-1 (2147483647): 2147483647
factors of 2³²-1 (4294967295): 3 × 5 × 17 × 257 × 65537
factors of 2³³-1 (8589934591): 7 × 23 × 89 × 599479
factors of 2³⁴-1 (17179869183): 3 × 43691 × 131071
factors of 2³⁵-1 (34359738367): 31 × 71 × 127 × 122921
factors of 2³⁶-1 (68719476735): 3 × 3 × 3 × 5 × 7 × 13 × 19 × 37 × 73 × 109
factors of 2³⁷-1 (137438953471): 223 × 616318177
factors of 2³⁸-1 (274877906943): 3 × 174763 × 524287
factors of 2³⁹-1 (549755813887): 7 × 79 × 8191 × 121369
factors of 2⁴⁰-1 (1099511627775): 3 × 5 × 5 × 11 × 17 × 31 × 41 × 61681
factors of 2⁴¹-1 (2199023255551): 13367 × 164511353
factors of 2⁴²-1 (4398046511103): 3 × 3 × 7 × 7 × 43 × 127 × 337 × 5419
factors of 2⁴³-1 (8796093022207): 431 × 9719 × 2099863
factors of 2⁴⁴-1 (17592186044415): 3 × 5 × 23 × 89 × 397 × 683 × 2113
factors of 2⁴⁵-1 (35184372088831): 7 × 31 × 73 × 151 × 631 × 23311
factors of 2⁴⁶-1 (70368744177663): 3 × 47 × 178481 × 2796203
factors of 2⁴⁷-1 (140737488355327): 2351 × 4513 × 13264529
factors of 2⁴⁸-1 (281474976710655): 3 × 3 × 5 × 7 × 13 × 17 × 97 × 241 × 257 × 673
factors of 2⁴⁹-1 (562949953421311): 127 × 4432676798593
factors of 2⁵⁰-1 (1125899906842623): 3 × 11 × 31 × 251 × 601 × 1801 × 4051
factors of 2⁵¹-1 (2251799813685247): 7 × 103 × 2143 × 11119 × 131071
factors of 2⁵²-1 (4503599627370495): 3 × 5 × 53 × 157 × 1613 × 2731 × 8191
factors of 2⁵³-1 (9007199254740991): 6361 × 69431 × 20394401
factors of 2⁵⁴-1 (18014398509481983): 3 × 3 × 3 × 3 × 7 × 19 × 73 × 87211 × 262657
factors of 2⁵⁵-1 (36028797018963967): 23 × 31 × 89 × 881 × 3191 × 201961
factors of 2⁵⁶-1 (72057594037927935): 3 × 5 × 17 × 29 × 43 × 113 × 127 × 15790321
factors of 2⁵⁷-1 (144115188075855871): 7 × 32377 × 524287 × 1212847
factors of 2⁵⁸-1 (288230376151711743): 3 × 59 × 233 × 1103 × 2089 × 3033169
factors of 2⁵⁹-1 (576460752303423487): 179951 × 3203431780337
factors of 2⁶⁰-1 (1152921504606846975): 3 × 3 × 5 × 5 × 7 × 11 × 13 × 31 × 41 × 61 × 151 × 331 × 1321
factors of 2⁶¹-1 (2305843009213693951): 2305843009213693951
factors of 2⁶²-1 (4611686018427387903): 3 × 715827883 × 2147483647
factors of 2⁶³-1 (9223372036854775807): 7 × 7 × 73 × 127 × 337 × 92737 × 649657
factors of 2⁶⁴-1 (18446744073709551615): 3 × 5 × 17 × 257 × 641 × 65537 × 6700417
factors of 2⁶⁵-1 (36893488147419103231): 31 × 8191 × 145295143558111
factors of 2⁶⁶-1 (73786976294838206463): 3 × 3 × 7 × 23 × 67 × 89 × 683 × 20857 × 599479
factors of 2⁶⁷-1 (147573952589676412927): 193707721 × 761838257287
factors of 2⁶⁸-1 (295147905179352825855): 3 × 5 × 137 × 953 × 26317 × 43691 × 131071
factors of 2⁶⁹-1 (590295810358705651711): 7 × 47 × 178481 × 10052678938039
factors of 2⁷⁰-1 (1180591620717411303423): 3 × 11 × 31 × 43 × 71 × 127 × 281 × 86171 × 122921
factors of 2⁷¹-1 (2361183241434822606847): 228479 × 48544121 × 212885833
factors of 2⁷²-1 (4722366482869645213695): 3 × 3 × 3 × 5 × 7 × 13 × 17 × 19 × 37 × 73 × 109 × 241 × 433 × 38737
factors of 2⁷³-1 (9444732965739290427391): 439 × 2298041 × 9361973132609
factors of 2⁷⁴-1 (18889465931478580854783): 3 × 223 × 1777 × 25781083 × 616318177
factors of 2⁷⁵-1 (37778931862957161709567): 7 × 31 × 151 × 601 × 1801 × 100801 × 10567201
factors of 2⁷⁶-1 (75557863725914323419135): 3 × 5 × 229 × 457 × 174763 × 524287 × 525313
factors of 2⁷⁷-1 (151115727451828646838271): 23 × 89 × 127 × 581283643249112959
factors of 2⁷⁸-1 (302231454903657293676543): 3 × 3 × 7 × 79 × 2731 × 8191 × 121369 × 22366891
factors of 2⁷⁹-1 (604462909807314587353087): 2687 × 202029703 × 1113491139767
factors of 2⁸⁰-1 (1208925819614629174706175): 3 × 5 × 5 × 11 × 17 × 31 × 41 × 257 × 61681 × 4278255361
factors of 2⁸¹-1 (2417851639229258349412351): 7 × 73 × 2593 × 71119 × 262657 × 97685839
factors of 2⁸²-1 (4835703278458516698824703): 3 × 83 × 13367 × 164511353 × 8831418697
factors of 2⁸³-1 (9671406556917033397649407): 167 × 57912614113275649087721
factors of 2⁸⁴-1 (19342813113834066795298815): 3 × 3 × 5 × 7 × 7 × 13 × 29 × 43 × 113 × 127 × 337 × 1429 × 5419 × 14449
factors of 2⁸⁵-1 (38685626227668133590597631): 31 × 131071 × 9520972806333758431
factors of 2⁸⁶-1 (77371252455336267181195263): 3 × 431 × 9719 × 2099863 × 2932031007403
factors of 2⁸⁷-1 (154742504910672534362390527): 7 × 233 × 1103 × 2089 × 4177 × 9857737155463
factors of 2⁸⁸-1 (309485009821345068724781055): 3 × 5 × 17 × 23 × 89 × 353 × 397 × 683 × 2113 × 2931542417
factors of 2⁸⁹-1 (618970019642690137449562111): 618970019642690137449562111
factors of 2⁹⁰-1 (1237940039285380274899124223): 3 × 3 × 3 × 7 × 11 × 19 × 31 × 73 × 151 × 331 × 631 × 23311 × 18837001
factors of 2⁹¹-1 (2475880078570760549798248447): 127 × 911 × 8191 × 112901153 × 23140471537
factors of 2⁹²-1 (4951760157141521099596496895): 3 × 5 × 47 × 277 × 1013 × 1657 × 30269 × 178481 × 2796203
factors of 2⁹³-1 (9903520314283042199192993791): 7 × 2147483647 × 658812288653553079
factors of 2⁹⁴-1 (19807040628566084398385987583): 3 × 283 × 2351 × 4513 × 13264529 × 165768537521
factors of 2⁹⁵-1 (39614081257132168796771975167): 31 × 191 × 524287 × 420778751 × 30327152671
factors of 2⁹⁶-1 (79228162514264337593543950335): 3 × 3 × 5 × 7 × 13 × 17 × 97 × 193 × 241 × 257 × 673 × 65537 × 22253377
factors of 2⁹⁷-1 (158456325028528675187087900671): 11447 × 13842607235828485645766393
factors of 2⁹⁸-1 (316912650057057350374175801343): 3 × 43 × 127 × 4363953127297 × 4432676798593
factors of 2⁹⁹-1 (633825300114114700748351602687): 7 × 23 × 73 × 89 × 199 × 153649 × 599479 × 33057806959
factors of 2¹⁰⁰-1 (1267650600228229401496703205375): 3 × 5 × 5 × 5 × 11 × 31 × 41 × 101 × 251 × 601 × 1801 × 4051 × 8101 × 268501
}

use Test;
is prime-factors( 536870911 ).join(' × '), '233 × 1103 × 2089';
is prime-factors( 2**100 -1 ).join(' × '), '3 × 5 × 5 × 5 × 11 × 31 × 41 × 101 × 251 × 601 × 1801 × 4051 × 8101 × 268501';
