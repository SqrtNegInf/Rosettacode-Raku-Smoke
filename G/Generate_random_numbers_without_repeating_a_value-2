#!/usr/bin/env raku
#u# http://rosettacode.org/wiki/Generate_random_numbers_without_repeating_a_value
#c# 2021-08-28 <RC
#m# MOAR: OK
#j# JVM:  BROKEN
#s# --optimize=0
#n# illustrate use of enhanced 'pick' (and illustrate another 'srand' fragility...)
#n# 2023-02-25 answer doesn't change despite '#s#' switch,  terminal/cron results still differ

use v6.e.PREVIEW; 

srand 123456;

my @res.push: $_ for (1..20).pick(**).[^100].batch(20);

.put for @res;

my $moar-terminal = q:to/END/;
16 11 13 19 9 12 10 6 17 3 5 2 20 1 4 15 18 7 8 14
2 17 20 1 14 12 19 13 9 3 11 7 6 16 15 10 18 8 5 4
8 2 12 15 14 10 16 17 1 4 13 18 19 11 7 3 20 9 5 6
12 19 2 6 4 13 11 9 3 7 17 14 5 20 8 15 18 1 10 16
11 1 14 19 4 15 18 10 20 13 8 2 12 5 6 16 17 7 9 3
END

my $moar-cronjob = q:to/END/;
15 9 16 5 8 4 20 2 7 12 18 3 6 10 1 17 11 14 13 19
1 19 14 5 4 12 10 2 20 7 17 13 9 8 3 15 6 16 11 18
20 14 1 6 15 18 3 17 8 5 11 2 19 7 4 10 16 13 12 9
16 13 4 10 9 11 8 5 17 7 19 1 2 20 18 15 3 12 6 14
20 14 17 16 13 3 18 9 11 8 2 15 12 19 10 6 4 5 7 1
END

if qx/uname -a/ ~~ /'iMac'/ {
$moar-cronjob = q:to/END/;
13 4 2 20 19 8 1 6 3 17 12 15 9 5 16 11 14 7 10 18
13 15 9 17 11 3 14 2 20 5 10 8 12 16 4 6 18 7 19 1
17 19 16 4 12 18 11 14 9 13 3 5 15 7 6 8 2 20 10 1
4 20 3 18 1 2 13 9 11 10 16 15 7 17 5 14 19 6 12 8
1 5 7 2 10 4 20 16 14 12 8 6 18 15 3 9 11 17 13 19
END
}

my $linux = q:to/END/;
6 16 18 11 9 10 3 14 4 12 7 8 17 15 19 1 20 5 13 2
20 17 5 11 10 12 6 14 9 19 15 16 7 2 18 4 3 13 8 1
5 11 19 16 15 14 7 8 10 13 2 12 9 1 17 6 4 18 3 20
1 3 15 6 12 4 14 7 19 16 20 11 9 10 18 2 13 8 17 5
16 11 15 10 8 20 1 5 6 19 12 13 7 14 2 18 17 3 4 9
END

use Test;
is @res.join("\n"), chomp $*KERNEL eq 'linux' ??  $linux !!  $*IN.t ?? $moar-terminal !! $moar-cronjob;
