#!/usr/bin/env raku
#u# http://rosettacode.org/wiki/Modified_random_distribution
#c# 2021-02-28 <RC
#m# MOAR: OK
#j# JVM:  OK
#n# new-disp 'srand' shift

srand 123456;

my @res;

sub modified_random_distribution ( Code $modifier --> Seq ) {
    return lazy gather loop {
        my ( $r1, $r2 ) = rand, rand;
        take $r1 if $modifier.($r1) > $r2;
    }
}
sub modifier ( Numeric $x --> Numeric ) {
    return 2 × ( $x < 1/2 ?? ( 1/2 - $x  )
                          !! ( $x  - 1/2 ) );
} 
sub print_histogram ( @data, :$n-bins, :$width ) { # Assumes minimum of zero.
    my %counts = bag @data.map: { floor( $_ × $n-bins ) / $n-bins };
    my $max_value = %counts.values.max;
    sub hist { '■' x ( $width × $^count / $max_value ) }
    #say ' Bin, Counts: Histogram';
    @res.push: sprintf "%4.2f, %6d: %s\n", .key, .value, hist(.value) for %counts.sort;
}

my @d = modified_random_distribution( &modifier );

print_histogram( @d.head(50_000), :n-bins(20), :width(64) );

.print for @res;

my $moar-cronjob = q:to/END/;
0.00,   4687: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.05,   4284: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.10,   3794: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.15,   3295: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.20,   2752: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.25,   2263: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.30,   1733: ■■■■■■■■■■■■■■■■■■■■■■■
0.35,   1304: ■■■■■■■■■■■■■■■■■
0.40,    694: ■■■■■■■■■
0.45,    262: ■■■
0.50,    253: ■■■
0.55,    744: ■■■■■■■■■
0.60,   1265: ■■■■■■■■■■■■■■■■
0.65,   1691: ■■■■■■■■■■■■■■■■■■■■■■
0.70,   2307: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.75,   2651: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.80,   3241: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.85,   3723: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.90,   4283: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.95,   4774: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
END

my $moar-terminal = q:to/END/;
0.00,   4687: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.05,   4284: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.10,   3795: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.15,   3295: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.20,   2751: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.25,   2263: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.30,   1734: ■■■■■■■■■■■■■■■■■■■■■■■
0.35,   1304: ■■■■■■■■■■■■■■■■■
0.40,    694: ■■■■■■■■■
0.45,    262: ■■■
0.50,    253: ■■■
0.55,    744: ■■■■■■■■■
0.60,   1263: ■■■■■■■■■■■■■■■■
0.65,   1690: ■■■■■■■■■■■■■■■■■■■■■■
0.70,   2307: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.75,   2651: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.80,   3242: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.85,   3723: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.90,   4284: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.95,   4774: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
END

my $jvm = q:to/END/;
0.00,   4802: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.05,   4213: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.10,   3805: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.15,   3197: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.20,   2764: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.25,   2236: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.30,   1792: ■■■■■■■■■■■■■■■■■■■■■■■
0.35,   1263: ■■■■■■■■■■■■■■■■
0.40,    714: ■■■■■■■■■
0.45,    236: ■■■
0.50,    246: ■■■
0.55,    753: ■■■■■■■■■■
0.60,   1220: ■■■■■■■■■■■■■■■■
0.65,   1780: ■■■■■■■■■■■■■■■■■■■■■■■
0.70,   2260: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.75,   2819: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.80,   3347: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.85,   3672: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.90,   4237: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.95,   4644: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
END

use Test;
is @res.join(''), $*VM ~~ /jvm/ ?? $jvm !! $*IN.t ?? $moar-terminal !! $moar-cronjob;
