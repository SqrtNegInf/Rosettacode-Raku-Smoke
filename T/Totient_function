#!/usr/bin/env perl6
#u# http://rosettacode.org/wiki/Totient_function
#c# 2018-12-05 <RC
#m# MOAR: OK
#j# JVM:  BROKEN
#n# see JVM for previous method of calculation
#n# OEIS:A000010 Euler totient function ðœ‘(n): count numbers â‰¤ n and prime to n

my @res;

use Prime::Factor;
 
my \ðœ‘ = 0, |(1..*).hyper.map: -> \t { t Ã— [Ã—] t.&prime-factors.squish.map: { 1 - 1/$_ } }
 
@res.push: sprintf "ðœ‘(%2d) = %3d %s", $_, ðœ‘[$_], $_ - ðœ‘[$_] - 1 ?? '' !! 'Prime' for 1 .. 25;
 
#(1e2, 1e3, 1e4, 1e5).map: -> $limit {
(1e2, 1e3, 1e4).map: -> $limit {
    @res.push: "\nCount of primes <= $limit: " ~ +(^$limit).grep: {$_ == ðœ‘[$_] + 1}
}

.say for @res;

my $ref = q:to/END/;
ðœ‘( 1) =   1 
ðœ‘( 2) =   1 Prime
ðœ‘( 3) =   2 Prime
ðœ‘( 4) =   2 
ðœ‘( 5) =   4 Prime
ðœ‘( 6) =   2 
ðœ‘( 7) =   6 Prime
ðœ‘( 8) =   4 
ðœ‘( 9) =   6 
ðœ‘(10) =   4 
ðœ‘(11) =  10 Prime
ðœ‘(12) =   4 
ðœ‘(13) =  12 Prime
ðœ‘(14) =   6 
ðœ‘(15) =   8 
ðœ‘(16) =   8 
ðœ‘(17) =  16 Prime
ðœ‘(18) =   6 
ðœ‘(19) =  18 Prime
ðœ‘(20) =   8 
ðœ‘(21) =  12 
ðœ‘(22) =  10 
ðœ‘(23) =  22 Prime
ðœ‘(24) =   8 
ðœ‘(25) =  20 

Count of primes <= 100: 25

Count of primes <= 1000: 168

Count of primes <= 10000: 1229
END

use Test;
is @res.join("\n"), chomp $ref;
