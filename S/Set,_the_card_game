#!/usr/bin/env raku
#u# https://rosettacode.org/wiki/Set,_the_card_game
#c# 2023-08-30 <RC
#m# MOAR: BROKEN OK
#j# JVM:  BROKEN OK
#n# need to replace 'srand'

srand 123456;

my @res;

my @attributes = <one two three>, <solid striped open>, <red green purple>, <diamond oval squiggle>;

sub face ($_) { .polymod(3 xx 3).kv.map({ @attributes[$^k;$^v] }) ~ ($_%3??'s'!!'') }

sub sets (@cards) {
    @cards.combinations(3).race.map: { (sum ([Z+] $_».polymod(3 xx 3)) »%» 3) ?? (next) !! $_ }
}

for 4,8,12 -> $deal {
    my @cards = (^81).pick($deal);
    my @sets = @cards.&sets;
    say "\nCards dealt: $deal";
    for @cards { put .&face };
    say "\nSets found: {+@sets}";
    for @sets { put .map(&face).join("\n"), "\n" };
}

#say "\nIn the whole deck, there are {+(^81).&sets} sets.";

.say for @res;
my $ref = q:to/END/;
END

use Test;
#my $ref = $*VM ~~ /jvm/ ?? $jvm !! $moar;
#is @res.join("\n"), chomp $ref;
#is @res.join('').subst(/<ws>/, '', :g), $ref.subst(/<ws>/, '', :g);
