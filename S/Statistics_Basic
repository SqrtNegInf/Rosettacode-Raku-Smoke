#!/usr/bin/env perl6
#u# http://rosettacode.org/wiki/Statistics/Basic
#c#  2015-11-03 <>RC, 2017-02-01 >RC
#m# MOAR: OK
#j#  JVM: OK
#n# 2020-10-07 different answers when run from interactive shell vs cron-launch?
#n# 2021-03-04 yes to above, and that has not changed

srand 123456;

my @res;
for 100, 1_000, 10_000 -> $N {
    @res.push: "size: $N";
    my @data = rand xx $N;
    @res.push: sprintf "mean:%f", my $mean = $N R/ [+] @data;
    @res.push: sprintf "stddev:%f", sqrt
    $mean**2 R- $N R/ [+] @data »**» 2;
    @res.push: sprintf "%.1f %s", .key, '=' x (500 × .value.elems / $N)
        for sort @data.classify: (10 × *).Int / 10; # DH b7c6e73, sort works on hash keys by default
    @res.push: '';
#    &say # DH change (bare 'say' no longer allowed)
}

.say for @res;

my $moar-terminal = qq:to/END/;
size: 100
mean:0.511915
stddev:0.289009
0.0 ==================================================
0.1 ========================================
0.2 ===========================================================================
0.3 =============================================
0.4 =========================
0.5 =======================================================
0.6 ==================================================
0.7 =============================================
0.8 ======================================================================
0.9 =============================================

size: 1000
mean:0.504817
stddev:0.287957
0.0 ================================================
0.1 =============================================
0.2 ======================================================
0.3 ================================================
0.4 ====================================================
0.5 =================================================
0.6 =================================================
0.7 ======================================================
0.8 =============================================
0.9 =====================================================

size: 10000
mean:0.499116
stddev:0.287404
0.0 =================================================
0.1 =================================================
0.2 ===================================================
0.3 =================================================
0.4 =================================================
0.5 ==================================================
0.6 ==================================================
0.7 ===================================================
0.8 ================================================
0.9 ================================================

END

my $moar-cronjob = qq:to/END/;
size: 100
mean:0.511915
stddev:0.289009
0.0 ==================================================
0.1 ========================================
0.2 ===========================================================================
0.3 =============================================
0.4 =========================
0.5 =======================================================
0.6 ==================================================
0.7 =============================================
0.8 ======================================================================
0.9 =============================================

size: 1000
mean:0.504321
stddev:0.286547
0.0 ===============================================
0.1 ============================================
0.2 ========================================================
0.3 ================================================
0.4 =====================================================
0.5 =================================================
0.6 =================================================
0.7 ======================================================
0.8 =============================================
0.9 ====================================================

size: 10000
mean:0.498989
stddev:0.287440
0.0 =================================================
0.1 =================================================
0.2 ===================================================
0.3 =================================================
0.4 =================================================
0.5 ==================================================
0.6 ==================================================
0.7 ===================================================
0.8 ================================================
0.9 ================================================

END

my $jvm = qq:to/END/;
size: 100
mean:0.472617
stddev:0.295259
0.0 =======================================================
0.1 ===========================================================================
0.2 ==================================================
0.3 ====================
0.4 ======================================================================
0.5 ========================================
0.6 ==================================================
0.7 =============================================
0.8 =============================================
0.9 ==================================================

size: 1000
mean:0.504637
stddev:0.282010
0.0 ==============================================
0.1 =================================================
0.2 ================================================
0.3 ================================================
0.4 ===============================================
0.5 ========================================================
0.6 ==============================================================
0.7 ===================================================
0.8 ==========================================
0.9 ================================================

size: 10000
mean:0.501515
stddev:0.291873
0.0 ====================================================
0.1 ================================================
0.2 ==================================================
0.3 ==================================================
0.4 ================================================
0.5 ==================================================
0.6 ================================================
0.7 ================================================
0.8 ================================================
0.9 ======================================================

END

use Test;
is @res.join("\n"), chomp $*VM ~~ /jvm/ ?? $jvm !! $*IN.t ?? $moar-terminal !! $moar-cronjob;
