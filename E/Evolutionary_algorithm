#!/usr/bin/env perl6
#u# http://rosettacode.org/wiki/Evolutionary_algorithm
#c# 2015-11-14 <RC, 2017-05-11 <RC, 2019-06-25 <RC
#m# MOAR: OK
#j#  JVM: OK
#n# hard to get rid of built-in random here: 'rand', 'roll' and 'pick' all present

srand 123456;

constant target = "METHINKS IT IS LIKE A WEASEL";
constant mutate_chance = .08;
constant @alphabet = flat 'A'..'Z',' ';
constant C = 100;

sub mutate { [~] (rand < mutate_chance ?? @alphabet.pick !! $_ for $^string.comb) }
#sub mutate { $^string.subst(/./, { rand < mutate_chance ?? @alphabet.pick !! $/ }, :g) }
#sub mutate { $^string.comb.map({ rand < mutate_chance ?? @alphabet.pick !! $_ }).join }
sub fitness { [+] $^string.comb Zeq @ = target.comb }

my @res;
loop (
    my $parent = @alphabet.roll(target.chars).join;
    $parent ne target;
    $parent = max :by(&fitness), mutate($parent) xx C
) { @res.push: sprintf "%6d: '%s'", $++, $parent }

#.say for @res; exit;

my $moar-terminal = qq:to/END/;
     0: 'IA IZCDTWETJBJPYZTMRFVGISDEU'
     1: 'IATIZCDBWKTJBHPY TMRFVGISDEU'
     2: 'IATIZCNSWKTJBHPL TMZFVGISDEK'
     3: 'IATIZCKSWKTJBHPL TMZFVGISDEK'
     4: 'IATIZCKSWKTJBHPL TEZFVGISDEK'
     5: 'IATIZCKSZKTJBHPL TEZF GISSEK'
     6: 'IATIZCKSZKTJBSPL TEZF GISSEK'
     7: 'MATIZCKSZKTJBSPLRMEZF GBSSEI'
     8: 'METIYCKSZKTJBSPLRMEZF GBSSEI'
     9: 'METIYCKSZKTJBSPLIMEZF GBSSEI'
    10: 'METIYCKSZKTJBSPLIKEZF GBSSEI'
    11: 'METIYCKSZKTJBSPLIKEZF GBSSEL'
    12: 'METIYCKSZKTJBSPLIKEZF GBSSEL'
    13: 'METIYCKSZYTJBSPLIKEZF GZASEL'
    14: 'METIICKSZYTJBSPLIKEZF XZASEL'
    15: 'METIICKSZYTJBSPLIKEZA XZASEL'
    16: 'METIICKS YTJBSPLIKELA XZASEL'
    17: 'METIICKS ITJBSPLIKEVA XZASEL'
    18: 'METIICKS ITJBSPLIKEVA XZASEL'
    19: 'METIICKS ITJBSPLIKEVA XZASEL'
    20: 'METHICKS ITJBSPLIKEVA XZASEL'
    21: 'METHINKS ITJBSPLIKEVA XZASEL'
    22: 'METHINKS ITJBSPLIKEVA XZASEL'
    23: 'METHINKS ITJBSPLIKEVA XZASEL'
    24: 'METHINKS ITJBSPLIKEVA XZASEL'
    25: 'METHINKS ITJBSPLIKEVA WTASEL'
    26: 'METHINKS ITJBSPLIKEVA WEASEL'
    27: 'METHINKS ITJBSPLIKEVA WEASEL'
    28: 'METHINKS ITJBSPLIKEVA WEASEL'
    29: 'METHINKS ITJBSPLIKEVA WEASEL'
    30: 'METHINKS ITJBSPLIKEVA WEASEL'
    31: 'METHINKS ITJBSPLIKEVA WEASEL'
    32: 'METHINKS ITJBSPLIKEVA WEASEL'
    33: 'METHINKS ITJBSPLIKEVA WEASEL'
    34: 'METHINKS ITJBSPLIKEVA WEASEL'
    35: 'METHINKS ITJBSPLIKEVA WEASEL'
    36: 'METHINKS ITKBSPLIKEVA WEASEL'
    37: 'METHINKS ITKISPLIKEVA WEASEL'
    38: 'METHINKS ITKISPLIKEVA WEASEL'
    39: 'METHINKS ITKISPLIKEVA WEASEL'
    40: 'METHINKS ITKISPLIKEVA WEASEL'
    41: 'METHINKS ITKISPLIKEVA WEASEL'
    42: 'METHINKS ITKISPLIKEVA WEASEL'
    43: 'METHINKS ITKISPLIKEVA WEASEL'
    44: 'METHINKS ITMISPLIKEVA WEASEL'
    45: 'METHINKS ITMISPLIKEVA WEASEL'
    46: 'METHINKS ITMISPLIKEVA WEASEL'
    47: 'METHINKS ITMISPLIKEVA WEASEL'
    48: 'METHINKS ITMISPLIKEVA WEASEL'
    49: 'METHINKS ITMISPLIKEVA WEASEL'
    50: 'METHINKS ITMISPLIKEVA WEASEL'
    51: 'METHINKS ITMISPLIKEVA WEASEL'
    52: 'METHINKS ITMISPLIKEVA WEASEL'
    53: 'METHINKS IT ISPLIKEVA WEASEL'
    54: 'METHINKS IT ISPLIKEVA WEASEL'
    55: 'METHINKS IT ISPLIKEVA WEASEL'
    56: 'METHINKS IT ISPLIKEVA WEASEL'
    57: 'METHINKS IT IS LIKEVA WEASEV'
    58: 'METHINKS IT IS LIKEVA WEASEV'
    59: 'METHINKS IT IS LIKEJA WEASEV'
    60: 'METHINKS IT IS LIKEJA WEASEV'
    61: 'METHINKS IT IS LIKE A WEASEV'
    62: 'METHINKS IT IS LIKE A WEASEV'
    63: 'METHINKS IT IS LIKE A WEASEV'
    64: 'METHINKS IT IS LIKE A WEASEV'
    65: 'METHINKS IT IS LIKE A WEASEV'
    66: 'METHINKS IT IS LIKE A WEASEV'
    67: 'METHINKS IT IS LIKE A WEASEO'
    68: 'METHINKS IT IS LIKE A WEASEO'
    69: 'METHINKS IT IS LIKE A WEASEO'
    70: 'METHINKS IT IS LIKE A WEASEO'
    71: 'METHINKS IT IS LIKE A WEASEO'
    72: 'METHINKS IT IS LIKE A WEASEO'
    73: 'METHINKS IT IS LIKE A WEASEO'
    74: 'METHINKS IT IS LIKE A WEASEO'
    75: 'METHINKS IT IS LIKE A WEASEO'
    76: 'METHINKS IT IS LIKE A WEASEI'
    77: 'METHINKS IT IS LIKE A WEASEI'
    78: 'METHINKS IT IS LIKE A WEASEI'
    79: 'METHINKS IT IS LIKE A WEASEI'
    80: 'METHINKS IT IS LIKE A WEASEI'
    81: 'METHINKS IT IS LIKE A WEASEI'
    82: 'METHINKS IT IS LIKE A WEASEI'
END

my $moar-cronjob = qq:to/END/;
     0: 'DTWETJBJPYZTMRFVGISDEUZKIWDV'
     1: 'DTWEIJBVPYZTMRFLGISDEUZKIWDV'
     2: 'DEWEIJBVPYZTMRFLGISDXUZKIWDV'
     3: 'DETEIJBIPYZTMRFLGISDXUAKIWDV'
     4: 'DETEIJBIPYZTMRFLGISDJUAKAWDV'
     5: 'DETHIJBIBYZTMRFLGISDJUAKADDV'
     6: 'DETHINBIBYZTMJFLGISDJUAKADDV'
     7: 'METHINBIBYZTMJFLGISDJUAKADMV'
     8: 'METHINBIBYZTMJFLGISDGUWKADMV'
     9: 'METHINBI YZWMJFLGISDGUWKADMV'
    10: 'METHINBI YZWMBFLGIVDAUWKAWMV'
    11: 'METHINBI YSRMBFLGIVDAUWEAWMV'
    12: 'METHINBI YSRMBFLGIVDAUWEAWMV'
    13: 'METHINBI YSRMB LGIVDAUWEAWMV'
    14: 'METHINBI YSRMB LGIVMAUWEAWML'
    15: 'METHINBI YSRMB LGIVYAUWEAWML'
    16: 'METHINBI YTRMB LGIVYAUWEAWML'
    17: 'METHINBI YTEMS LGIVYAUWEAWML'
    18: 'METHINBI YTEMS LGIV AUWEAMML'
    19: 'METHINBI ITEMS LGIV AUWEAMML'
    20: 'METHIN I ITEIS LGIV AUWEAMML'
    21: 'METHIN I ITEIS LGIE AUWEAMML'
    22: 'METHINKI ITEIS LGIE AUWEAMML'
    23: 'METHINKI ITEIS LGIE AUWEAMML'
    24: 'METHINKI ITEIS LGIE AUWEAMML'
    25: 'METHINKI ITEIS LGIE AUWEAMML'
    26: 'METHINKI ITUIS LJIE AUWEAMML'
    27: 'METHINKI ITUIS LJIE AUWEAMYL'
    28: 'METHINKU ITUIS LJIE AUWEAYYL'
    29: 'METHINKU ITUIS LJIE A WEAYYL'
    30: 'METHINKU ITUISKLIIE A WEAYYL'
    31: 'METHINKP ITUISKLIIE A WEAYYL'
    32: 'METHINKP ITUISKLIIE A WEAYYL'
    33: 'METHINKP ITUISKLIIE A WEAYYL'
    34: 'METHINKM ITUISKLIQE A WEAYYL'
    35: 'METHINKM ITUISKLIQE A WEAYYL'
    36: 'METHINKM ITUISKLIQE A WEASTL'
    37: 'METHINKM ITUISKLIQE A WEASTL'
    38: 'METHINKM ITUISKLIQE A WEASTL'
    39: 'METHINKM ITUISKLIQE A WEASTL'
    40: 'METHINKM ITUISKLIQE A WEASTL'
    41: 'METHINKM IT ISGLIQE A WEASTL'
    42: 'METHINKM IT ISOLIQE A WEASTL'
    43: 'METHINKM IT ISQLITE A WEASTL'
    44: 'METHINKM IT ISVLITE A WEASTL'
    45: 'METHINKV IT ISVLITE A WEASTL'
    46: 'METHINKV IT IS LITE A WEASTL'
    47: 'METHINKV IT IS LITE A WEASTL'
    48: 'METHINKV IT IS LITE A WEASTL'
    49: 'METHINKV IT IS LITE A WEASTL'
    50: 'METHINKV IT IS LITE A WEASTL'
    51: 'METHINKV IT IS LITE A WEASEL'
    52: 'METHINKV IT IS LITE A WEASEL'
    53: 'METHINKV IT IS LITE A WEASEL'
    54: 'METHINKV IT IS LITE A WEASEL'
    55: 'METHINKV IT IS LITE A WEASEL'
    56: 'METHINKV IT IS LIKE A WEASEL'
    57: 'METHINK  IT IS LIKE A WEASEL'
    58: 'METHINK  IT IS LIKE A WEASEL'
    59: 'METHINK  IT IS LIKE A WEASEL'
    60: 'METHINK  IT IS LIKE A WEASEL'
    61: 'METHINK  IT IS LIKE A WEASEL'
    62: 'METHINK  IT IS LIKE A WEASEL'
    63: 'METHINK  IT IS LIKE A WEASEL'
    64: 'METHINK  IT IS LIKE A WEASEL'
    65: 'METHINK  IT IS LIKE A WEASEL'
    66: 'METHINK  IT IS LIKE A WEASEL'
    67: 'METHINK  IT IS LIKE A WEASEL'
    68: 'METHINK  IT IS LIKE A WEASEL'
    69: 'METHINK  IT IS LIKE A WEASEL'
    70: 'METHINK  IT IS LIKE A WEASEL'
    71: 'METHINK  IT IS LIKE A WEASEL'
    72: 'METHINK  IT IS LIKE A WEASEL'
    73: 'METHINK  IT IS LIKE A WEASEL'
    74: 'METHINNS IT IS LIKE A WEASEL'
    75: 'METHINNS IT IS LIKE A WEASEL'
    76: 'METHINNS IT IS LIKE A WEASEL'
    77: 'METHINNS IT IS LIKE A WEASEL'
    78: 'METHINNS IT IS LIKE A WEASEL'
    79: 'METHINNS IT IS LIKE A WEASEL'
    80: 'METHINIS IT IS LIKE A WEASEL'
    81: 'METHINIS IT IS LIKE A WEASEL'
    82: 'METHINIS IT IS LIKE A WEASEL'
    83: 'METHINIS IT IS LIKE A WEASEL'
    84: 'METHINAS IT IS LIKE A WEASEL'
END

my $jvm = qq:to/END/;
     0: 'L GTBOLOYSMDDQICEZRTQRWFEEAY'
     1: 'L GHBOLOYSTDDQICEZRYZRWFEEAY'
     2: 'L GHBNLONSTDDQICEZRYARWFEEAY'
     3: 'L GHBNLSNSTDDQICEZRYARWFEEAY'
     4: 'L GHBNLSKSTDDQ CEZRYARWDEYNY'
     5: 'L GHBNTSKST DQ CEZSPARWDEYIY'
     6: 'L CHBNES ST DQ CEZSPARWDEYIY'
     7: 'O CHBNES ST DQ CEZSPA WDEYSL'
     8: 'O CHBNZS ST DQ CEZSPA WDESSL'
     9: 'O CHBNZS ST DQ CEZPPA WEESSL'
    10: 'O CHBNZS ST DQ CEZPPA WEESSL'
    11: 'O CHBNZS ST DQ LEZ FA WEESSL'
    12: 'OEPHBNZS ST DQ LEZ FA WEESSL'
    13: 'OEPHINZS ST DQ LEZ FA WEESSL'
    14: 'OEPHINZS ST SS LEZ FA WEESSL'
    15: 'OEPHINZS ST SS LEZ FA WEESSL'
    16: 'OEPHINZS ST SS LEXEFA WEESSL'
    17: 'OEPHINZS ST SS LEXEFA WEESSL'
    18: 'OEPHINZS ST SS LIXEVA WETSSL'
    19: 'OEPHINKS ST SS LIIEVA WETSSL'
    20: 'OEPHINKS ST SS LIIEVA WETSSL'
    21: 'OEPHINKS ST SS LIIEZA WETSSL'
    22: 'PEPHINKS ST SS LISE A WETSSL'
    23: 'PEPHINKS ST SS LIWE A WETSSL'
    24: 'PEPHINKS ST SS LIWE A WEASSL'
    25: 'PETHINKS LT SS LIWE A WEASSL'
    26: 'PETHINKS LT SS LIWE A WEASSL'
    27: 'YETHINKS LT SS LIWE A WEASSL'
    28: 'YETHINKS LT SS LIWE A WEASSL'
    29: 'YETHINKS LT SS LIDE A WEASSL'
    30: 'YETHINKS LT SS LIDE A WEASSL'
    31: 'YETHINKS IT SS LIDE A WEASSL'
    32: 'YETHINKS IT SS LIDE A WEASSL'
    33: 'YETHINKS IT SS LIDE A WEASZL'
    34: 'YETHINKS IT SS LIDE A WEASZL'
    35: 'YETHINKS IT SS LIDE A WEASNL'
    36: 'YETHINKS IT SS LIDE A WEASNL'
    37: 'YETHINKS IT SS LIDE A WEASNL'
    38: 'YETHINKS IT SS LIDE A WEASNL'
    39: 'YETHINKS IT SS LIKE A WEASNL'
    40: 'YETHINKS IT SS LIKE A WEASNL'
    41: 'YETHINKS IT IS LIKE A WEASNL'
    42: 'YETHINKS IT IS LIKE A WEASNL'
    43: 'YETHINKS IT IS LIKE A WEASNL'
    44: 'YETHINKS IT IS LIKE A WEASEL'
    45: 'YETHINKS IT IS LIKE A WEASEL'
    46: 'GETHINKS IT IS LIKE A WEASEL'
    47: 'GETHINKS IT IS LIKE A WEASEL'
    48: 'GETHINKS IT IS LIKE A WEASEL'
END

use Test;
is @res.join("\n"), chomp $*VM ~~ /jvm/ ?? $jvm !! $*IN.t ?? $moar-terminal !! $moar-cronjob;
