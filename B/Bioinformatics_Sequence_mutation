#!/usr/bin/env perl6
#u# http://rosettacode.org/wiki/Bioinformatics/Sequence_mutation
#c# 2019-11-26 <RC
#m# MOAR: OK
#j# JVM:  OK
#n# 2022-02-03 until now! so just a week (and did not revert to old answer, now gives a 3rd distinct answer)
#n# 2022-01-26 as a test, fixed 'srand' output, see how long it lasts

srand 123456;

my @res;

my @bases = <A C G T>;

# The DNA strand
my $dna = @bases.roll(200).join;

# The Task
@res.push: "ORIGINAL DNA STRAND:";
@res.push: pretty $dna;
@res.push: "\nTotal bases: "~ +my $bases = $dna.comb.Bag;
@res.push: $bases.sort( ~*.key ).join: "\n";

@res.push: "\nMUTATED DNA STRAND:";
my $mutate = $dna.&mutate(10);
@res.push: pretty diff $dna, $mutate;
@res.push: "\nTotal bases: "~ +my $mutated = $mutate.comb.Bag;
@res.push: $mutated.sort( ~*.key ).join: "\n";


# Helper subs
sub pretty ($string, $wrap = 50) {
    $string.comb($wrap).map( { sprintf "%8d: %s", $++ Ã— $wrap, $_ } ).join: "\n"
}

sub mutate ($dna is copy, $count = 1) {
    $dna.substr-rw((^$dna.chars).roll, 1) = @bases.roll for ^$count;
    $dna
}

sub diff ($orig, $repl) {
    ($orig.comb Z $repl.comb).map( -> ($o, $r) { $o eq $r ?? $o !! $r.lc }).join
}

.say for @res;

my $moar-terminal = q:to/END/;
ORIGINAL DNA STRAND:
       0: ACGGTGCCGTACTTACGGTGAAGCGAGTCCTCTTACATAAATTTTGGGTC
      50: TCCTAGACGTGGTCGCATGGTTCATCTAAGTAGCACGTTGCGATCCGAAT
     100: TCCTATGAATCAAAGCCTCTAGAACATCACGCGCCAGCGCTGAAGGTTTT
     150: TTGCCTGGAACTTAGAATGGTTGCCGGACGATTACCGTCAGTAGATGTGT

Total bases: 200
A	47
C	46
G	51
T	56

MUTATED DNA STRAND:
       0: AgGGTGCCGTACTTACGGTGAAGCGAGTCCTCcTACATAAATTTTGGGTC
      50: TCCTAGACGTGtTCGCATtGTTCATCTAAGTAGCACGTTGCaAgCCGAAT
     100: TCCTATGAATCAAAGCCTCTAGAACATCACGCGCCAGCGCTGAAGGTTTT
     150: TTGCCTtGAACTTAGAATGGTTGCCGGACGATTACCGaCAGTAGATGTGT

Total bases: 200
A	49
C	46
G	49
T	56
END

my $moar-cronjob = q:to/END/;
ORIGINAL DNA STRAND:
       0: CCGTACTTACGGTGAAGCGAGTCCTCTTACATAAATTTTGGGTCTCCTAG
      50: ACGTGGTCGCATGGTTCATCTAAGTAGCACGTTGCGATCCGAATTCCTAT
     100: GAATCAAAGCCTCTAGAACATCACGCGCCAGCGCTGAAGGTTTTTTGCCT
     150: GGAACTTAGAATGGTTGCCGGACGATTACCGTCAGTAGATGTGTACGAGA

Total bases: 200
A	49
C	46
G	50
T	55

MUTATED DNA STRAND:
       0: CgGTACTTACGGTGAAGCGAGTCCTCTTACATcAATTTTGGGTCTCCTAG
      50: ACGTGGTCGCATGGTTCATCTAAGTAGCAgGTTGCGATCCGgAgTCCTAT
     100: GAATCAAAGCCTCTAGAACATgACGCGCCAGCGCTGAAGGTTTTTgGCCa
     150: GGAACTTAGAATGGTTGCCGGACGATTACCGTCAGTAaATGTGTACGAGA

Total bases: 200
A	49
C	44
G	55
T	52
END

my $jvm = q:to/END/;
ORIGINAL DNA STRAND:
       0: CTCGAGCGTGCAAGCAATGGGGTAAAATAACCACCGTGGCAGCCGTTTCA
      50: GTTTAAATCACGCCTTAATCTGAACAGATAAATGCCGAAGAGGGCGTTCA
     100: AGAGAGTGCACTCCGGGAGTCTCATCATGGACAGGATAGCCGTCTAGTCA
     150: GGTCGATATTAGGGTTGACAGCCCGGTGGGGTGACACATTCGGCGCGATG

Total bases: 200
A	53
C	45
G	60
T	42

MUTATED DNA STRAND:
       0: CTCGAGtGTGCAAGCAATGGGGTAAAATAACCACCGTGGCAGCCGTTTtA
      50: GTTTAgATCACGCCTTAATCTGAACAGATAAATGCCGAAGAGGGCGTTCA
     100: AGAGAGTGCACTCCGGGAcTgTCATCATGGACAGGATAGCgGTCTAGTCA
     150: GGTCGATATTAGGGTTGACAGCCCGGTGGGGTGACACATTCGGCGCGATG

Total bases: 200
A	52
C	42
G	62
T	44
END

use Test;
#is @res.join("\n"), 
my $ref = $*VM ~~ /jvm/ ?? $jvm !! $*IN.t ?? $moar-terminal !! $moar-cronjob;
is @res.join('').subst(/<ws>/, '', :g), $ref.subst(/<ws>/, '', :g);
